---
import type { SidebarItem } from "./Sidebar";

export interface Props {
  items: SidebarItem[];
  basePath: string;
  backPath: string;
  moduleName: string;
}

const { items, basePath, backPath, moduleName } = Astro.props;
---

<aside class="sidebar">
  <div class="sidebar-header">
    <h3>{moduleName}</h3>
  </div>

  <nav class="sidebar-nav modules-nav">
    {
      items.map((item) => (
        <div class="module-item expanded">
          <a href={`${basePath}/${item.children[0].slug}`} class="nav-link module-link">
            <span class="module-icon">üìÑ</span>
            <span class="module-text">{item.title}</span>
          </a>
          <div class="submenu">
            {item.children.map((child) => (
              <a href={`${basePath}#${child.slug.substring(1)}`} class="submenu-link">
                {child.title}
              </a>
            ))}
          </div>
        </div>
      ))
    }
  </nav>

  <div class="sidebar-footer">
    <a href={backPath} class="back-link">‚Üê Volver a M√≥dulos</a>
  </div>
</aside>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll(".sidebar .nav-link");

    navLinks.forEach((link) => {
      const linkPath = new URL(link.href).pathname;
      if (currentPath === linkPath) {
        link.classList.add("active");
      }
    });

    const submenuLinks = document.querySelectorAll(".sidebar .submenu-link");
    const handleScroll = () => {
      let currentSectionId = "";
      const sections = document.querySelectorAll(".content-card[id]");

      sections.forEach((section) => {
        const sectionTop = section.offsetTop;
        if (window.scrollY >= sectionTop - 100) {
          currentSectionId = section.getAttribute("id");
        }
      });

      submenuLinks.forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("href").includes(`#${currentSectionId}`)) {
          link.classList.add("active");
        }
      });
    };

    window.addEventListener("scroll", handleScroll);
    handleScroll(); // Initial check
  });
</script>
